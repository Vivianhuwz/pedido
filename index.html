<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YOUBAI - Sistema de Gerenciamento de Pedidos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Adicionar biblioteca SheetJS para processar arquivos Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            success: '#00B42A',
            warning: '#FF7D00',
            danger: '#F53F3F',
            'gray-50': '#F5F7FA',
            'gray-100': '#E5E6EB',
            'gray-200': '#C9CDD4',
            'gray-300': '#86909C',
            'gray-400': '#4E5969',
            'gray-500': '#1D2129',
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  // Evitar perda de dados ao atualizar a página
  window.addEventListener('beforeunload', function(e) {
    // Se houver alterações não sincronizadas, alertar o usuário
    if (orders.length > 0 && document.getElementById('syncStatus') && 
        document.getElementById('syncStatus').querySelector('span').textContent !== 'Sincronizado') {
      e.preventDefault();
      e.returnValue = '';
    }
  });
  </script>
  <style>
    .status-option {
      transition: background-color 0.2s;
    }
    .status-option:hover {
      background-color: #f3f4f6;
    }
    /* 添加统计板卡片的悬停效果 */
    .stat-card {
      transition: all 0.3s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    /* 复选框样式 */
    .form-checkbox {
        appearance: none;
        -webkit-appearance: none;
        border: 1px solid #cbd5e0;
        border-radius: 0.25rem;
        display: inline-block;
        position: relative;
        vertical-align: middle;
        background-color: #fff;
        color: #4299e1;
        cursor: pointer;
    }
    
    .form-checkbox:checked {
        background-color: currentColor;
        border-color: currentColor;
    }
    
    .form-checkbox:checked::after {
        content: '';
        display: block;
        position: absolute;
        top: 0.1rem;
        left: 0.3rem;
        width: 0.3rem;
        height: 0.6rem;
        border: solid white;
        border-width: 0 0.15rem 0.15rem 0;
        transform: rotate(45deg);
    }

    /* 移动端导航样式 */
    .mobile-nav-item {
      transition: all 0.3s ease;
    }
    
    .mobile-nav-item.active {
      background: linear-gradient(135deg, #165DFF 0%, #4299e1 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(22, 93, 255, 0.3);
    }
    
    .mobile-nav-item:hover:not(.active) {
      background-color: #f8fafc;
      transform: translateY(-1px);
    }

    /* 汉堡菜单动画 */
    .hamburger-line {
      transition: all 0.3s ease;
    }
    
    .hamburger-open .hamburger-line:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    
    .hamburger-open .hamburger-line:nth-child(2) {
      opacity: 0;
    }
    
    .hamburger-open .hamburger-line:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    /* Logo样式和动画 */
    .company-logo {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .company-logo:hover {
      transform: scale(1.05) rotate(5deg);
      box-shadow: 0 8px 25px rgba(22, 93, 255, 0.3);
    }
    
    .company-logo svg {
      transition: all 0.3s ease;
    }
    
    .company-logo:hover svg {
      transform: scale(1.1);
    }

    /* 移动端优化 */
    @media (max-width: 768px) {
      .mobile-nav-scroll {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      
      .mobile-nav-scroll::-webkit-scrollbar {
        display: none;
      }
      
      .stat-card:hover {
        transform: none;
      }
      
      .company-logo:hover {
        transform: scale(1.02);
      }
    }
  </style>
</head>

<body class="font-inter bg-gray-50 text-gray-500 min-h-screen">
  <!-- 顶部导航栏 -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <!-- Logo和标题区域 -->
    <div class="px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo和标题 -->
        <div class="flex items-center space-x-3">
          <div class="hidden sm:block">
            <h1 class="text-lg font-semibold text-gray-500">YOUBAI</h1>
            <p class="text-xs text-gray-300">Sistema de Gerenciamento de Pedidos</p>
          </div>
        </div>
        
        <!-- 搜索框 - 桌面版 -->
        <div class="hidden md:flex flex-1 justify-center mx-8">
          <div class="relative w-80">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa fa-search text-gray-300"></i>
            </div>
            <input type="text" id="headerSearchInput" placeholder="Pesquisar pedidos..." 
              class="w-full pl-10 pr-4 py-2 border border-gray-100 rounded-lg focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary"
              oninput="searchOrders()">
          </div>
        </div>
        
        <!-- 移动端菜单按钮 -->
        <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors" onclick="toggleMobileMenu()">
          <div class="w-6 h-6 flex flex-col justify-center items-center">
            <div class="hamburger-line w-5 h-0.5 bg-gray-500 mb-1"></div>
            <div class="hamburger-line w-5 h-0.5 bg-gray-500 mb-1"></div>
            <div class="hamburger-line w-5 h-0.5 bg-gray-500"></div>
          </div>
        </button>
      </div>
    </div>
    
    <!-- 移动端搜索框 -->
    <div class="md:hidden px-4 pb-4">
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <i class="fa fa-search text-gray-300"></i>
        </div>
        <input type="text" id="mobileSearchInput" placeholder="Pesquisar pedidos..." 
          class="w-full pl-10 pr-4 py-2 border border-gray-100 rounded-lg focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary"
          oninput="searchOrders()">
      </div>
    </div>
    
    <!-- 导航菜单 - 桌面版 -->
    <nav class="hidden md:block border-t border-gray-100">
      <div class="px-4 sm:px-6 lg:px-8">
        <div class="flex space-x-1 py-3 overflow-x-auto mobile-nav-scroll">
          <a href="#" onclick="filterByStatus('all')" id="nav-all" class="mobile-nav-item active flex items-center px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap">
            <i class="fa fa-list mr-2"></i>
            <span>Todos</span>
            <span class="ml-2 bg-white bg-opacity-20 text-xs px-2 py-1 rounded-full" id="count-all">0</span>
          </a>
          <a href="#" onclick="filterByStatus('pending')" id="nav-pending" class="mobile-nav-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg whitespace-nowrap">
            <i class="fa fa-clock-o mr-2 text-orange-500"></i>
            <span>Aguardando</span>
            <span class="ml-2 bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-full" id="count-pending">0</span>
          </a>
          <a href="#" onclick="filterByStatus('processing')" id="nav-processing" class="mobile-nav-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg whitespace-nowrap">
            <i class="fa fa-spinner mr-2 text-blue-500"></i>
            <span>Processando</span>
            <span class="ml-2 bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full" id="count-processing">0</span>
          </a>
          <a href="#" onclick="filterByStatus('completed')" id="nav-completed" class="mobile-nav-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg whitespace-nowrap">
            <i class="fa fa-check-circle mr-2 text-green-500"></i>
            <span>Concluído</span>
            <span class="ml-2 bg-green-100 text-green-600 text-xs px-2 py-1 rounded-full" id="count-completed">0</span>
          </a>
          <a href="#" onclick="filterByStatus('cancelled')" id="nav-cancelled" class="mobile-nav-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg whitespace-nowrap">
            <i class="fa fa-times-circle mr-2 text-red-500"></i>
            <span>Cancelado</span>
            <span class="ml-2 bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full" id="count-cancelled">0</span>
          </a>
        </div>
      </div>
    </nav>
    
    <!-- 移动端导航菜单 -->
    <nav id="mobileNav" class="md:hidden hidden border-t border-gray-100 bg-white">
      <div class="px-4 py-3 space-y-2">
        <a href="#" onclick="filterByStatus('all'); closeMobileMenu()" id="nav-all-mobile" class="mobile-nav-item active flex items-center px-4 py-3 text-sm font-medium rounded-lg">
          <i class="fa fa-list mr-3"></i>
          <span>Todos os Pedidos</span>
          <span class="ml-auto bg-white bg-opacity-20 text-xs px-2 py-1 rounded-full" id="count-all-mobile">0</span>
        </a>
        <a href="#" onclick="filterByStatus('pending'); closeMobileMenu()" id="nav-pending-mobile" class="mobile-nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
          <i class="fa fa-clock-o mr-3 text-orange-500"></i>
          <span>Aguardando</span>
          <span class="ml-auto bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-full" id="count-pending-mobile">0</span>
        </a>
        <a href="#" onclick="filterByStatus('processing'); closeMobileMenu()" id="nav-processing-mobile" class="mobile-nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
          <i class="fa fa-spinner mr-3 text-blue-500"></i>
          <span>Processando</span>
          <span class="ml-auto bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full" id="count-processing-mobile">0</span>
        </a>
        <a href="#" onclick="filterByStatus('completed'); closeMobileMenu()" id="nav-completed-mobile" class="mobile-nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
          <i class="fa fa-check-circle mr-3 text-green-500"></i>
          <span>Concluído</span>
          <span class="ml-auto bg-green-100 text-green-600 text-xs px-2 py-1 rounded-full" id="count-completed-mobile">0</span>
        </a>
        <a href="#" onclick="filterByStatus('cancelled'); closeMobileMenu()" id="nav-cancelled-mobile" class="mobile-nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
          <i class="fa fa-times-circle mr-3 text-red-500"></i>
          <span>Cancelado</span>
          <span class="ml-auto bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full" id="count-cancelled-mobile">0</span>
        </a>
      </div>
    </nav>
  </header>

  <!-- 主要内容区域 -->
  <main class="flex-1 px-4 sm:px-6 lg:px-8 py-6">
      <!-- Painel de estatísticas -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6 mb-6 sm:mb-8">
        <!-- Total de pedidos -->
        <div class="bg-white rounded-xl shadow-sm p-3 sm:p-6 stat-card">
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <p class="text-xs sm:text-sm font-medium text-gray-400 mb-1 truncate">Total de Pedidos</p>
              <p class="text-lg sm:text-2xl font-bold text-gray-500" id="totalOrders">0</p>
              <p class="text-xs text-green-500 mt-1 hidden sm:block">
                <i class="fa fa-arrow-up"></i>
                <span id="totalOrdersGrowth">0%</span> em relação ao mês anterior
              </p>
            </div>
            <div class="w-8 h-8 sm:w-12 sm:h-12 bg-blue-100 rounded-full flex items-center justify-center ml-2">
              <i class="fa fa-file-text-o text-sm sm:text-xl text-blue-600"></i>
            </div>
          </div>
        </div>

        <!-- Pedidos pendentes -->
        <div class="bg-white rounded-xl shadow-sm p-3 sm:p-6 stat-card">
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <p class="text-xs sm:text-sm font-medium text-gray-400 mb-1 truncate">Pedidos Pendentes</p>
              <p class="text-lg sm:text-2xl font-bold text-gray-500" id="pendingOrders">0</p>
              <p class="text-xs text-orange-500 mt-1 hidden sm:block">
                <i class="fa fa-arrow-up"></i>
                <span id="pendingOrdersGrowth">0%</span> em relação ao mês anterior
              </p>
            </div>
            <div class="w-8 h-8 sm:w-12 sm:h-12 bg-orange-100 rounded-full flex items-center justify-center ml-2">
              <i class="fa fa-clock-o text-sm sm:text-xl text-orange-600"></i>
            </div>
          </div>
        </div>

        <!-- Pedidos concluídos -->
        <div class="bg-white rounded-xl shadow-sm p-3 sm:p-6 stat-card">
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <p class="text-xs sm:text-sm font-medium text-gray-400 mb-1 truncate">Pedidos Concluídos</p>
              <p class="text-lg sm:text-2xl font-bold text-gray-500" id="completedOrders">0</p>
              <p class="text-xs text-green-500 mt-1 hidden sm:block">
                <i class="fa fa-arrow-up"></i>
                <span id="completedOrdersGrowth">0%</span> em relação ao mês anterior
              </p>
            </div>
            <div class="w-8 h-8 sm:w-12 sm:h-12 bg-green-100 rounded-full flex items-center justify-center ml-2">
              <i class="fa fa-check-circle text-sm sm:text-xl text-green-600"></i>
            </div>
          </div>
        </div>

        <!-- Valor total dos pedidos -->
        <div class="bg-white rounded-xl shadow-sm p-3 sm:p-6 stat-card">
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <p class="text-xs sm:text-sm font-medium text-gray-400 mb-1 truncate">Valor Total dos Pedidos</p>
              <p class="text-lg sm:text-2xl font-bold text-gray-500" id="totalRevenue">¥0</p>
              <p class="text-xs text-green-500 mt-1 hidden sm:block">
                <i class="fa fa-arrow-up"></i>
                <span id="revenueGrowth">0%</span> em relação ao mês anterior
              </p>
            </div>
            <div class="w-8 h-8 sm:w-12 sm:h-12 bg-blue-100 rounded-full flex items-center justify-center ml-2">
              <i class="fa fa-money text-sm sm:text-xl text-blue-600"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de pedidos -->
      <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
        <div class="p-4 sm:p-6 border-b border-gray-100">
          <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-500">Lista de Pedidos</h2>
            <!-- 按钮区域 -->
            <div class="flex flex-wrap gap-2 sm:space-x-3 sm:gap-0">
              <button onclick="showImportModal()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-50 transition-colors text-sm">
                <i class="fa fa-upload mr-1 sm:mr-2"></i><span class="hidden sm:inline">Importar Dados</span><span class="sm:hidden">Importar</span>
              </button>
              <button id="batchOperationsBtn" onclick="showBatchOperationsModal()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-purple-100 text-purple-600 rounded-lg hover:bg-purple-200 transition-colors text-sm" disabled>
                <i class="fa fa-tasks mr-1 sm:mr-2"></i><span class="hidden sm:inline">Operações em Lote</span><span class="sm:hidden">Lote</span>
              </button>
              <button onclick="printOrderList()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm">
                <i class="fa fa-print mr-1 sm:mr-2"></i><span class="hidden sm:inline">Imprimir Lista</span><span class="sm:hidden">Imprimir</span>
              </button>
              <button onclick="showAddOrderModal()" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm">
                <i class="fa fa-plus mr-1 sm:mr-2"></i><span class="hidden sm:inline">Novo Pedido</span><span class="sm:hidden">Novo</span>
              </button>
            </div>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-100">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-center">
                  <input type="checkbox" id="selectAllOrders" class="form-checkbox h-4 w-4 text-blue-600 transition duration-150 ease-in-out" onchange="toggleAllOrders(this.checked)">
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">NF</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Pedido</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase relative">
                  <div class="flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors" onclick="toggleColumnFilter('client')">
                    <span>Cliente</span>
                    <svg class="w-4 h-4 text-gray-400 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                  <div id="filter-client" class="absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden">
                    <div class="p-3">
                      <div class="space-y-2 max-h-48 overflow-y-auto" id="filter-options-client">
                        <!-- 筛选选项将动态生成 -->
                      </div>
                    </div>
                  </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase relative">
                  <div class="flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors" onclick="toggleColumnFilter('issueDate')">
                    <span>Data de Emissão</span>
                    <svg class="w-4 h-4 text-gray-400 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                  <div id="filter-issueDate" class="absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden">
                    <div class="p-3">
                      <div class="space-y-2 max-h-48 overflow-y-auto" id="filter-options-issueDate">
                        <!-- 筛选选项将动态生成 -->
                      </div>
                    </div>
                  </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Valor Final</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Desc Tipo Pedido</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase relative">
                  <div class="flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors" onclick="toggleColumnFilter('representative')">
                    <span>Representante</span>
                    <svg class="w-4 h-4 text-gray-400 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                  <div id="filter-representative" class="absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden">
                    <div class="p-3">
                      <div class="space-y-2 max-h-48 overflow-y-auto" id="filter-options-representative">
                        <!-- 筛选选项将动态生成 -->
                      </div>
                    </div>
                  </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase relative">
                  <div class="flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors" onclick="toggleColumnFilter('status')">
                    <span>Status</span>
                    <svg class="w-4 h-4 text-gray-400 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                  <div id="filter-status" class="absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden">
                    <div class="p-3">
                      <div class="space-y-2 max-h-48 overflow-y-auto" id="filter-options-status">
                        <!-- 筛选选项将动态生成 -->
                      </div>
                    </div>
                  </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">CX</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Operador</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Modalidade de entrega</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Ações</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100" id="orderTableBody">
              <!-- Os dados dos pedidos serão inseridos dinamicamente via JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Constantes para armazenamento e API
    const STORAGE_KEY = 'order_management_system_data';
    const API_BASE_URL = 'https://api.example.com'; // Substitua pela URL real da sua API
    
    // 选中的订单ID数组
    let selectedOrderIds = [];
    
    // 列筛选状态
    let columnFilters = {
      client: [],
      issueDate: [],
      representative: [],
      status: []
    };
    
    let currentOpenFilter = null;
    
    // 切换列筛选下拉菜单
    function toggleColumnFilter(column) {
      const filterId = `filter-${column}`;
      const filterElement = document.getElementById(filterId);
      
      // 关闭其他打开的筛选菜单
      if (currentOpenFilter && currentOpenFilter !== filterId) {
        document.getElementById(currentOpenFilter).classList.add('hidden');
      }
      
      if (filterElement.classList.contains('hidden')) {
        // 生成筛选选项
        generateFilterOptions(column);
        filterElement.classList.remove('hidden');
        currentOpenFilter = filterId;
      } else {
        filterElement.classList.add('hidden');
        currentOpenFilter = null;
      }
    }
    
    // 生成筛选选项
    function generateFilterOptions(column) {
      const optionsContainer = document.getElementById(`filter-options-${column}`);
      
      // 获取该列的所有唯一值
      let uniqueValues = [];
      if (column === 'client') {
        // 对于客户列，获取原始公司名称并格式化显示（只显示"-"后面的内容）
        const rawCompanies = [...new Set(orders.map(order => order.company))].sort();
        uniqueValues = rawCompanies.map(company => ({
          raw: company,
          display: formatCompanyNameForFilter(company)
        }));
      } else if (column === 'issueDate') {
        // 对于日期列，获取原始日期值并格式化为DD/MM/YYYY显示
        const rawDates = [...new Set(orders.map(order => order.issueDate))].sort();
        uniqueValues = rawDates.map(date => ({
          raw: date,
          display: formatDateForFilter(date)
        }));
      } else if (column === 'representative') {
        uniqueValues = [...new Set(orders.map(order => order.representative))].filter(rep => rep && rep.trim() !== '').sort();
      } else if (column === 'status') {
        uniqueValues = [...new Set(orders.map(order => order.status))].sort();
      }
      
      // 生成HTML
      let html = `
        <div class="flex items-center justify-between mb-3">
          <span class="text-sm font-medium text-gray-700">Filtrar por:</span>
          <button onclick="clearColumnFilter('${column}')" class="text-xs text-blue-600 hover:text-blue-800">Limpar</button>
        </div>
        <label class="flex items-center space-x-2 mb-2 cursor-pointer">
          <input type="checkbox" ${columnFilters[column].length === uniqueValues.length && uniqueValues.length > 0 ? 'checked' : ''} onchange="selectAllFilterOptions(&quot;${column}&quot;, this.checked)" class="form-checkbox h-4 w-4 text-blue-600">
          <span class="text-sm text-gray-700 font-medium">Todos</span>
        </label>
        <hr class="mb-2">
      `;
      
      uniqueValues.forEach(value => {
        let displayValue, rawValue;
        if ((column === 'issueDate' || column === 'client') && typeof value === 'object') {
          displayValue = value.display;
          rawValue = value.raw;
        } else {
          displayValue = value;
          rawValue = value;
        }
        
        const isChecked = columnFilters[column].length > 0 && columnFilters[column].includes(rawValue);
        html += `
          <label class="flex items-center space-x-2 mb-1 cursor-pointer hover:bg-gray-50 p-1 rounded">
            <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleFilterOption(&quot;${column}&quot;, &quot;${rawValue.replace(/"/g, '&quot;')}&quot;, this.checked)" class="form-checkbox h-4 w-4 text-blue-600">
            <span class="text-sm text-gray-600">${displayValue}</span>
          </label>
        `;
      });
      
      optionsContainer.innerHTML = html;
    }
    
    // 切换筛选选项
    function toggleFilterOption(column, value, checked) {
      if (checked) {
        if (!columnFilters[column].includes(value)) {
          columnFilters[column].push(value);
        }
      } else {
        columnFilters[column] = columnFilters[column].filter(v => v !== value);
      }
      
      // 更新全选复选框状态
      let allValues = [];
      if (column === 'client') {
        allValues = [...new Set(orders.map(order => order.company))];
      } else if (column === 'issueDate') {
        allValues = [...new Set(orders.map(order => order.issueDate))];
      } else if (column === 'representative') {
        allValues = [...new Set(orders.map(order => order.representative))];
      } else if (column === 'status') {
        allValues = [...new Set(orders.map(order => order.status))];
      }
      
      const selectAllCheckbox = document.querySelector(`#filter-options-${column} input[type="checkbox"]:first-child`);
      if (selectAllCheckbox) {
        selectAllCheckbox.checked = columnFilters[column].length === allValues.length && allValues.length > 0;
      }
      
      applyColumnFilters();
      updateFilterArrows();
    }
    
    // 全选/取消全选筛选选项
    function selectAllFilterOptions(column, checked) {
      if (checked) {
        // 全选：获取所有选项并设置筛选
        let allValues = [];
        if (column === 'client') {
          allValues = [...new Set(orders.map(order => order.company))];
        } else if (column === 'issueDate') {
          allValues = [...new Set(orders.map(order => order.issueDate))];
        } else if (column === 'representative') {
          allValues = [...new Set(orders.map(order => order.representative))];
        } else if (column === 'status') {
          allValues = [...new Set(orders.map(order => order.status))];
        }
        columnFilters[column] = [...allValues];
      } else {
        // 取消全选：清空筛选（显示所有项目）
        columnFilters[column] = [];
      }
      
      // 更新所有复选框状态
      const checkboxes = document.querySelectorAll(`#filter-options-${column} input[type="checkbox"]:not(:first-child)`);
      checkboxes.forEach(checkbox => {
        checkbox.checked = checked;
      });
      
      applyColumnFilters();
      updateFilterArrows();
    }
    
    // 清除列筛选
    function clearColumnFilter(column) {
      columnFilters[column] = [];
      generateFilterOptions(column);
      applyColumnFilters();
      updateFilterArrows();
    }
    
    // 应用列筛选
    function applyColumnFilters() {
      let filtered = orders;
      
      // 应用状态筛选（导航筛选）
      if (currentStatusFilter && currentStatusFilter !== 'all') {
        filtered = filtered.filter(order => {
          const status = order.status.toLowerCase();
          switch (currentStatusFilter) {
            case 'pending':
              return ['aguardando', 'pendente'].includes(status);
            case 'processing':
              return ['processando', 'em andamento'].includes(status);
            case 'completed':
              return ['concluído', 'finalizado'].includes(status);
            case 'cancelled':
              return status === 'cancelado';
            default:
              return true;
          }
        });
      }
      
      // 应用各列筛选
      Object.keys(columnFilters).forEach(column => {
        if (columnFilters[column].length > 0) {
          filtered = filtered.filter(order => {
            let value;
            if (column === 'client') {
              value = order.company;
            } else if (column === 'issueDate') {
              value = order.issueDate;
            } else if (column === 'representative') {
              value = order.representative;
            } else if (column === 'status') {
              value = order.status;
            }
            return columnFilters[column].includes(value);
          });
        }
      });
      
      // 应用搜索筛选
      const searchTerm = document.getElementById('headerSearchInput')?.value?.toLowerCase() || 
                        document.getElementById('mobileSearchInput')?.value?.toLowerCase() || '';
      if (searchTerm) {
        filtered = filtered.filter(order => {
          return (
            (order.nf && order.nf.toLowerCase().includes(searchTerm)) ||
            (order.company && order.company.toLowerCase().includes(searchTerm)) ||
            (order.representative && order.representative.toLowerCase().includes(searchTerm)) ||
            (order.operator && order.operator.toLowerCase().includes(searchTerm)) ||
            (order.orderTypeDescription && order.orderTypeDescription.toLowerCase().includes(searchTerm)) ||
            (order.id && order.id.toString().includes(searchTerm))
          );
        });
      }
      
      filteredOrders = filtered;
      renderFilteredOrders();
      updateFilteredStatistics();
      updateSidebarCounts();
    }
    
    // 更新筛选箭头显示
    function updateFilterArrows() {
      Object.keys(columnFilters).forEach(column => {
        const arrow = document.querySelector(`[onclick="toggleColumnFilter('${column}')"] svg`);
        if (arrow) {
          if (columnFilters[column].length > 0) {
            arrow.classList.remove('text-gray-400');
            arrow.classList.add('text-blue-500');
          } else {
            arrow.classList.remove('text-blue-500');
            arrow.classList.add('text-gray-400');
          }
        }
      });
    }
    
    // 移动端菜单功能
    function toggleMobileMenu() {
      const mobileNav = document.getElementById('mobileNav');
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      
      if (mobileNav.classList.contains('hidden')) {
        mobileNav.classList.remove('hidden');
        mobileMenuBtn.classList.add('hamburger-open');
      } else {
        mobileNav.classList.add('hidden');
        mobileMenuBtn.classList.remove('hamburger-open');
      }
    }
    
    function closeMobileMenu() {
      const mobileNav = document.getElementById('mobileNav');
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      
      mobileNav.classList.add('hidden');
      mobileMenuBtn.classList.remove('hamburger-open');
    }
    
    // 点击外部关闭移动端菜单和筛选菜单
    document.addEventListener('click', function(event) {
      const mobileNav = document.getElementById('mobileNav');
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      
      if (mobileNav && !mobileNav.classList.contains('hidden') && 
          !mobileNav.contains(event.target) && 
          !mobileMenuBtn.contains(event.target)) {
        closeMobileMenu();
      }
      
      // 关闭筛选菜单
      if (currentOpenFilter) {
        const filterElement = document.getElementById(currentOpenFilter);
        const clickedInsideFilter = filterElement && filterElement.contains(event.target);
        const clickedOnFilterButton = event.target.closest('[onclick*="toggleColumnFilter"]');
        
        if (!clickedInsideFilter && !clickedOnFilterButton) {
          filterElement.classList.add('hidden');
          currentOpenFilter = null;
        }
      }
    });
    
    // 全选/取消全选订单
    function toggleAllOrders(checked) {
      document.querySelectorAll('.order-checkbox').forEach(checkbox => {
        checkbox.checked = checked;
      });
      updateBatchOperationsButton();
    }
    
    // 更新批量操作按钮状态
    function updateBatchOperationsButton() {
      selectedOrderIds = Array.from(document.querySelectorAll('.order-checkbox:checked')).map(checkbox => 
        parseInt(checkbox.getAttribute('data-order-id'))
      );
      
      const batchBtn = document.getElementById('batchOperationsBtn');
      if (selectedOrderIds.length > 0) {
        batchBtn.removeAttribute('disabled');
        batchBtn.classList.remove('bg-purple-100', 'text-purple-600');
        batchBtn.classList.add('bg-purple-600', 'text-white');
      } else {
        batchBtn.setAttribute('disabled', 'disabled');
        batchBtn.classList.remove('bg-purple-600', 'text-white');
        batchBtn.classList.add('bg-purple-100', 'text-purple-600');
      }
    }
    
    // 显示批量操作模态框
    function showBatchOperationsModal() {
      if (selectedOrderIds.length === 0) return;
      
      document.getElementById('selectedOrdersCount').textContent = selectedOrderIds.length;
      document.getElementById('deleteOrdersCount').textContent = selectedOrderIds.length;
      document.getElementById('batchOperationsModal').classList.remove('hidden');
      
      // 重置表单
      document.getElementById('updateStatus').checked = false;
      document.getElementById('updateRepresentative').checked = false;
      document.getElementById('updateOperator').checked = false;
      document.getElementById('updateDeliveryMode').checked = false;
      
      document.getElementById('batchStatus').disabled = true;
      document.getElementById('batchRepresentative').disabled = true;
      document.getElementById('batchOperator').disabled = true;
      document.getElementById('batchDeliveryMode').disabled = true;
      
      // 默认选择更新操作
      document.querySelector('input[name="operationType"][value="update"]').checked = true;
      toggleOperationType('update');
      
      // 添加复选框变化事件
      document.getElementById('updateStatus').addEventListener('change', function() {
        document.getElementById('batchStatus').disabled = !this.checked;
      });
      
      document.getElementById('updateRepresentative').addEventListener('change', function() {
        document.getElementById('batchRepresentative').disabled = !this.checked;
      });
      
      document.getElementById('updateOperator').addEventListener('change', function() {
        document.getElementById('batchOperator').disabled = !this.checked;
      });
      
      document.getElementById('updateDeliveryMode').addEventListener('change', function() {
        document.getElementById('batchDeliveryMode').disabled = !this.checked;
      });
      
      // 添加操作类型切换事件
      document.querySelectorAll('input[name="operationType"]').forEach(radio => {
        radio.addEventListener('change', function() {
          toggleOperationType(this.value);
        });
      });
    }
    
    // 应用批量更新或删除
    function applyBatchOperations(e) {
        e.preventDefault();
        
        const operationType = document.querySelector('input[name="operationType"]:checked').value;
        
        if (operationType === 'update') {
            // 批量更新
            const updateStatus = document.getElementById('updateStatus').checked;
            const updateRepresentative = document.getElementById('updateRepresentative').checked;
            const updateOperator = document.getElementById('updateOperator').checked;
            const updateDeliveryMode = document.getElementById('updateDeliveryMode').checked;
            
            if (!updateStatus && !updateRepresentative && !updateOperator && !updateDeliveryMode) {
                alert('Por favor, selecione pelo menos um campo para atualizar.');
                return;
            }
            
            const newStatus = updateStatus ? document.getElementById('batchStatus').value : null;
            const newRepresentative = updateRepresentative ? document.getElementById('batchRepresentative').value : null;
            const newOperator = updateOperator ? document.getElementById('batchOperator').value : null;
            const newDeliveryMode = updateDeliveryMode ? document.getElementById('batchDeliveryMode').value : null;
            
            // 更新选中的订单
            selectedOrderIds.forEach(id => {
                const orderIndex = orders.findIndex(o => o.id === id);
                if (orderIndex !== -1) {
                    if (updateStatus) orders[orderIndex].status = newStatus;
                    if (updateRepresentative) orders[orderIndex].representative = newRepresentative;
                    if (updateOperator) orders[orderIndex].operator = newOperator;
                    if (updateDeliveryMode) orders[orderIndex].deliveryMode = newDeliveryMode;
                    orders[orderIndex].updatedAt = new Date().toISOString();
                }
            });
            
            showNotification('Pedidos atualizados com sucesso!', 'success');
        } else {
            // 批量删除 - 直接删除，不需要确认文本
            orders = orders.filter(order => !selectedOrderIds.includes(order.id));
            showNotification(`${selectedOrderIds.length} pedidos excluídos com sucesso!`, 'success');
        }
        
        // Salvar alterações
        saveToLocalStorage();
        
        // 重新应用过滤器和更新显示
        applyFilters();
        
        // 关闭模态框
        closeBatchOperationsModal();
        
        // 清除选择
        selectedOrderIds = [];
        document.getElementById('selectAllOrders').checked = false;
        updateBatchOperationsButton();
    }
    
    // 切换操作类型（更新/删除）
    function toggleOperationType(type) {
      if (type === 'update') {
        document.getElementById('updateFieldsSection').classList.remove('hidden');
        document.getElementById('deleteConfirmSection').classList.add('hidden');
        document.getElementById('batchSubmitBtn').textContent = 'Aplicar Alterações';
        document.getElementById('batchSubmitBtn').classList.remove('bg-red-600', 'hover:bg-red-700');
        document.getElementById('batchSubmitBtn').classList.add('bg-blue-600', 'hover:bg-blue-700');
      } else {
        document.getElementById('updateFieldsSection').classList.add('hidden');
        document.getElementById('deleteConfirmSection').classList.remove('hidden');
        document.getElementById('batchSubmitBtn').textContent = 'Excluir Pedidos';
        document.getElementById('batchSubmitBtn').classList.remove('bg-blue-600', 'hover:bg-blue-700');
        document.getElementById('batchSubmitBtn').classList.add('bg-red-600', 'hover:bg-red-700');
      }
    }
    
    // 关闭批量操作模态框
    function closeBatchOperationsModal() {
      document.getElementById('batchOperationsModal').classList.add('hidden');
    }
    
    // 订单数据数组
    let orders = [
      {
        id: 1,
        nf: "NF001",
        company: "12345 - Empresa ABC Ltda",
        issueDate: "2024-01-15",
        finalValue: 15000.00,
        orderTypeDescription: "Venda Normal",
        representative: "João Silva",
        status: "Concluído",
        cx: "CX001",
        operator: "Maria Santos",
        deliveryMode: "Entrega Expressa"
      },
      {
        id: 2,
        nf: "NF002",
        company: "67890 - Tech Solutions",
        issueDate: "2024-01-16",
        finalValue: 25000.00,
        orderTypeDescription: "Venda Especial",
        representative: "Ana Costa",
        status: "Processando",
        cx: "CX002",
        operator: "Pedro Lima",
        deliveryMode: "Entrega Normal"
      },
      {
        id: 3,
        nf: "NF003",
        company: "11111 - Inovação Digital",
        issueDate: "2024-01-17",
        finalValue: 8500.00,
        orderTypeDescription: "Venda Normal",
        representative: "Carlos Mendes",
        status: "Aguardando",
        cx: "CX003",
        operator: "Lucia Ferreira",
        deliveryMode: "Retirada no Local"
      },
      {
        id: 4,
        nf: "NF004",
        company: "22222 - Comercial Santos",
        issueDate: "2024-01-18",
        finalValue: 12000.00,
        orderTypeDescription: "Venda Normal",
        representative: "João Silva",
        status: "Processando",
        cx: "CX004",
        operator: "Ana Oliveira",
        deliveryMode: "Entrega Normal"
      }
    ];
    
    // 过滤后的订单数组
    let filteredOrders = [];
    
    // 初始化搜索功能
    function initializeSearch() {
      const searchInput = document.getElementById('headerSearchInput');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          applyFilters();
        });
      }
    }
    
    // 在DOM加载完成后初始化搜索
    document.addEventListener('DOMContentLoaded', function() {
      initializeSearch();
    });

    // 初始化搜索功能
    function initializeSearch() {
      const searchInput = document.getElementById('headerSearchInput');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          applyFilters();
        });
      }
    }

    // 在DOM加载完成后初始化搜索
    document.addEventListener('DOMContentLoaded', function() {
      initializeSearch();
    });
    
    // 当前选中的状态过滤器
    let currentStatusFilter = 'all';
    
    // 当前打开的状态下拉菜单ID
    let currentOpenStatusDropdown = null;
    
    // 状态映射
    const statusMap = {
      'Aguardando': { class: 'bg-orange-100 text-orange-800', icon: 'fa-clock-o' },
      'Processando': { class: 'bg-blue-100 text-blue-800', icon: 'fa-spinner' },
      'Concluído': { class: 'bg-green-100 text-green-800', icon: 'fa-check-circle' },
      'Cancelado': { class: 'bg-red-100 text-red-800', icon: 'fa-times-circle' }
    };
    
    // 根据状态过滤订单
    function filterByStatus(status) {
        currentStatusFilter = status;
        
        // 更新桌面版导航栏样式 - 移除所有active类（桌面版导航在.hidden.md:block的nav中）
        document.querySelectorAll('nav.hidden.md\\:block .mobile-nav-item').forEach(item => {
            item.classList.remove('active');
            item.classList.add('text-gray-600');
        });
        
        // 更新移动端导航栏样式 - 移除所有active类
        document.querySelectorAll('#mobileNav .mobile-nav-item').forEach(item => {
            item.classList.remove('active');
            item.classList.add('text-gray-600');
        });
        
        // 激活当前选中的导航项（桌面版）
        const activeNav = document.getElementById(`nav-${status}`);
        if (activeNav) {
            activeNav.classList.remove('text-gray-600');
            activeNav.classList.add('active');
        }
        
        // 激活当前选中的导航项（移动端）
        const activeMobileNav = document.getElementById(`nav-${status}-mobile`);
        if (activeMobileNav) {
            activeMobileNav.classList.remove('text-gray-600');
            activeMobileNav.classList.add('active');
        }
        
        // 应用过滤器
        applyFilters();
    }
    
    // 应用所有过滤器（状态 + 搜索 + 列筛选）
    function applyFilters() {
        // 直接调用列筛选功能，它会处理所有筛选逻辑
        applyColumnFilters();
    }
    
    // 更新侧边栏计数
    function updateSidebarCounts() {
        const counts = {
            all: orders.length,
            pending: orders.filter(o => ['aguardando', 'pendente'].includes(o.status.toLowerCase())).length,
            processing: orders.filter(o => ['processando', 'em andamento'].includes(o.status.toLowerCase())).length,
            completed: orders.filter(o => ['concluído', 'finalizado'].includes(o.status.toLowerCase())).length,
            cancelled: orders.filter(o => o.status.toLowerCase() === 'cancelado').length
        };
        
        Object.keys(counts).forEach(status => {
            // 更新桌面版计数
            const countElement = document.getElementById(`count-${status}`);
            if (countElement) {
                countElement.textContent = counts[status];
            }
            
            // 更新移动端计数
            const mobileCountElement = document.getElementById(`count-${status}-mobile`);
            if (mobileCountElement) {
                mobileCountElement.textContent = counts[status];
            }
        });
    }
    
    // 搜索订单函数 - 简化为只调用 applyFilters
    function searchOrders() {
        applyFilters();
    }
    
    // 渲染过滤后的订单
    function renderFilteredOrders() {
        const tableBody = document.getElementById('orderTableBody');
        
        if (filteredOrders.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="13" class="px-6 py-8 text-center text-gray-400">
                        <i class="fa fa-search text-4xl mb-4 block"></i>
                        <p class="text-lg font-medium mb-2">Nenhum pedido encontrado</p>
                        <p class="text-sm">Tente ajustar os filtros de pesquisa</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        // 添加格式化客户名称的函数
        function formatCompanyName(companyName) {
            if (!companyName) return '';
            
            // 检查是否包含 " - " 分隔符
            const separatorIndex = companyName.indexOf(' - ');
            let name = companyName;
            if (separatorIndex !== -1) {
                // 获取分隔符后面的部分
                name = companyName.substring(separatorIndex + 3).trim();
            }
            
            // 将名称分成单词数组
            const words = name.split(' ');
            
            // 根据单词数量分成3行
            if (words.length <= 3) {
                // 如果单词数量少于等于3，每行一个单词
                return words.map(word => `<div>${word}</div>`).join('');
            } else {
                // 如果单词数量多于3，尽量平均分配
                const wordsPerLine = Math.ceil(words.length / 3);
                const line1 = words.slice(0, wordsPerLine).join(' ');
                const line2 = words.slice(wordsPerLine, wordsPerLine * 2).join(' ');
                const line3 = words.slice(wordsPerLine * 2).join(' ');
                
                return `<div>${line1}</div><div>${line2}</div><div>${line3}</div>`;
            }
        }
        
        // 修改渲染函数中的客户显示部分
        tableBody.innerHTML = filteredOrders.map(order => {
            const statusInfo = statusMap[order.status] || { class: 'bg-gray-100 text-gray-800', icon: 'fa-question' };
            
            return `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-4 py-4 text-center">
                        <input type="checkbox" class="order-checkbox form-checkbox h-4 w-4 text-blue-600 transition duration-150 ease-in-out" 
                               data-order-id="${order.id}" onchange="updateBatchOperationsButton()">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-500">${formatValue(order.nf)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatValue(order.pedido)}</td>
                    <td class="px-3 py-2">
                        <div class="text-sm font-medium text-gray-500">${formatCompanyName(order.company)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatDate(order.issueDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-500">${formatCurrency(order.finalValue)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatValue(order.orderTypeDescription)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatValue(order.representative)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusInfo.class} cursor-pointer hover:opacity-80" onclick="toggleStatusDropdown(${order.id}, event)">
                            <i class="fa ${statusInfo.icon} mr-1"></i>
                            ${formatValue(order.status)}
                        </span>
                        <div id="status-dropdown-${order.id}" class="hidden absolute z-10 mt-1 bg-white rounded-md shadow-lg py-1 text-sm">
                            <div class="px-2 py-1 text-xs text-gray-500 font-medium">Alterar status:</div>
                            <div class="status-option hover:bg-gray-100 px-3 py-1.5 cursor-pointer" onclick="updateOrderStatus(${order.id}, 'Aguardando')">Aguardando</div>
                            <div class="status-option hover:bg-gray-100 px-3 py-1.5 cursor-pointer" onclick="updateOrderStatus(${order.id}, 'Processando')">Processando</div>
                            <div class="status-option hover:bg-gray-100 px-3 py-1.5 cursor-pointer" onclick="updateOrderStatus(${order.id}, 'Concluído')">Concluído</div>
                            <div class="status-option hover:bg-gray-100 px-3 py-1.5 cursor-pointer" onclick="updateOrderStatus(${order.id}, 'Cancelado')">Cancelado</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatValue(order.cx)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatValue(order.operator)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatValue(order.deliveryMode)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="editOrder(${order.id})" class="text-primary hover:text-primary/80 transition-colors">
                                <i class="fa fa-edit"></i>
                            </button>
                            <button onclick="deleteOrder(${order.id})" class="text-red-500 hover:text-red-700 transition-colors">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    }
    
    // 更新过滤后的统计信息
    function updateFilteredStatistics() {
        const total = filteredOrders.length;
        const pending = filteredOrders.filter(order => ['Aguardando', 'Pendente'].includes(order.status)).length;
        const completed = filteredOrders.filter(order => ['Concluído', 'Finalizado'].includes(order.status)).length;
        const totalRevenue = filteredOrders.reduce((sum, order) => sum + order.finalValue, 0);
        
        document.getElementById('totalOrders').textContent = total;
        document.getElementById('pendingOrders').textContent = pending;
        document.getElementById('completedOrders').textContent = completed;
        document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
    }
    
    // 格式化货币
    function formatCurrency(value) {
        if (value === undefined || value === null || isNaN(value)) {
            return '';
        }
        return new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        }).format(value);
    }
    
    // 格式化日期
    function formatDate(dateString) {
        if (!dateString || dateString === undefined) {
            return '';
        }
        const date = new Date(dateString);
        return date.toLocaleDateString('pt-BR');
    }
    
    // 格式化日期用于筛选选项显示（DD/MM/YYYY格式）
    function formatDateForFilter(dateString) {
        if (!dateString || dateString === undefined) {
            return '';
        }
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }
    
    // 格式化公司名称用于筛选选项显示（只显示"-"后面的内容）
    function formatCompanyNameForFilter(companyName) {
        if (!companyName || companyName === undefined) {
            return '';
        }
        // 检查是否包含 " - " 分隔符
        const separatorIndex = companyName.indexOf(' - ');
        if (separatorIndex !== -1) {
            // 返回分隔符后面的部分
            return companyName.substring(separatorIndex + 3).trim();
        }
        // 如果没有分隔符，返回原始名称
        return companyName;
    }
    
    // 格式化公司名称
    function formatCompanyName(company) {
        if (!company || company === undefined) {
            return '';
        }
        // 检查是否包含 " - " 分隔符
        if (company.includes(' - ')) {
            return company.split(' - ')[1] || '';
        }
        return company;
    }
    
    // 通用格式化函数 - 处理 undefined 值
    function formatValue(value) {
        if (value === undefined || value === null) {
            return '';
        }
        return value;
    }
    
    // 显示添加订单模态框
    function showAddOrderModal() {
        document.getElementById('addOrderModal').classList.remove('hidden');
        document.getElementById('orderForm').reset();
    }
    
    // 关闭添加订单模态框
    function closeAddOrderModal() {
        document.getElementById('addOrderModal').classList.add('hidden');
    }
    
    // 显示导入模态框
    function showImportModal() {
        document.getElementById('importModal').classList.remove('hidden');
        initializeFileUpload(); // 初始化文件上传区域
    }
    
    // 关闭导入模态框
    function closeImportModal() {
        document.getElementById('importModal').classList.add('hidden');
        resetImportForm();
    }
    
    // 重置导入表单
    function resetImportForm() {
        document.getElementById('importFile').value = '';
        document.getElementById('fileInfo').classList.add('hidden');
        document.getElementById('fileName').textContent = '';
        document.getElementById('fileSize').textContent = '';
    }
    
    // 初始化文件上传
    function initializeFileUpload() {
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('importFile');
        const selectFileBtn = document.getElementById('selectFileBtn');
        
        // 点击选择文件按钮时触发文件选择
        selectFileBtn.addEventListener('click', function() {
            fileInput.click();
        });
        
        // 文件选择事件
        fileInput.addEventListener('change', handleFileSelect);
        
        // 拖拽事件
        dropArea.addEventListener('dragover', handleDragOver);
        dropArea.addEventListener('dragleave', handleDragLeave);
        dropArea.addEventListener('drop', handleFileDrop);
    }
    
    // 处理文件选择
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            validateAndSetFile(file);
        }
    }
    
    // 处理拖拽悬停
    function handleDragOver(event) {
        event.preventDefault();
        event.currentTarget.classList.add('border-gray-400');
    }
    
    // 处理拖拽离开
    function handleDragLeave(event) {
        event.preventDefault();
        event.currentTarget.classList.remove('border-gray-400');
    }
    
    // 处理文件拖放
    function handleFileDrop(event) {
        event.preventDefault();
        event.currentTarget.classList.remove('border-gray-400');
        
        const files = event.dataTransfer.files;
        if (files.length > 0) {
            validateAndSetFile(files[0]);
        }
    }
    
    // 验证并设置文件
    function validateAndSetFile(file) {
        // 检查文件类型
        const fileName = file.name.toLowerCase();
        if (!fileName.endsWith('.json') && !fileName.endsWith('.csv') && 
            !fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
            alert('请选择支持的文件格式 (JSON, CSV, Excel)');
            return;
        }
        
        // 显示文件信息
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = `(${(file.size / 1024).toFixed(1)} KB)`;
        document.getElementById('fileInfo').classList.remove('hidden');
        
        // 设置文件到文件输入框
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        document.getElementById('importFile').files = dataTransfer.files;
    }
    
    // 编辑订单
    function editOrder(id) {
        const order = orders.find(o => o.id === id);
        if (order) {
            document.getElementById('editOrderId').value = order.id;
            document.getElementById('editNf').value = order.nf || '';
            document.getElementById('editCompany').value = order.company || '';
            document.getElementById('editIssueDate').value = order.issueDate || '';
            document.getElementById('editFinalValue').value = order.finalValue || '';
            document.getElementById('editOrderTypeDescription').value = order.orderTypeDescription || '';
            document.getElementById('editRepresentative').value = order.representative || '';
            document.getElementById('editStatus').value = order.status || 'Pendente';
            document.getElementById('editCx').value = order.cx || '';
            document.getElementById('editOperator').value = order.operator || '';
            document.getElementById('editDeliveryMode').value = order.deliveryMode || '';
            
            document.getElementById('editOrderModal').classList.remove('hidden');
        }
    }
    
    // 关闭编辑订单模态框
    function closeEditOrderModal() {
        document.getElementById('editOrderModal').classList.add('hidden');
    }
    
    // 删除订单
    function deleteOrder(id) {
        if (confirm('Tem certeza que deseja excluir este pedido?')) {
            orders = orders.filter(order => order.id !== id);
            saveToLocalStorage(); // Salvar automaticamente
            applyFilters();
        }
    }
    
    // 应用批量更新或删除
    function applyBatchOperations(e) {
        e.preventDefault();
        
        const operationType = document.querySelector('input[name="operationType"]:checked').value;
        
        if (operationType === 'update') {
            // 批量更新
            const updateStatus = document.getElementById('updateStatus').checked;
            const updateRepresentative = document.getElementById('updateRepresentative').checked;
            const updateOperator = document.getElementById('updateOperator').checked;
            const updateDeliveryMode = document.getElementById('updateDeliveryMode').checked;
            
            if (!updateStatus && !updateRepresentative && !updateOperator && !updateDeliveryMode) {
                alert('Por favor, selecione pelo menos um campo para atualizar.');
                return;
            }
            
            const newStatus = updateStatus ? document.getElementById('batchStatus').value : null;
            const newRepresentative = updateRepresentative ? document.getElementById('batchRepresentative').value : null;
            const newOperator = updateOperator ? document.getElementById('batchOperator').value : null;
            const newDeliveryMode = updateDeliveryMode ? document.getElementById('batchDeliveryMode').value : null;
            
            // 更新选中的订单
            selectedOrderIds.forEach(id => {
                const orderIndex = orders.findIndex(o => o.id === id);
                if (orderIndex !== -1) {
                    if (updateStatus) orders[orderIndex].status = newStatus;
                    if (updateRepresentative) orders[orderIndex].representative = newRepresentative;
                    if (updateOperator) orders[orderIndex].operator = newOperator;
                    if (updateDeliveryMode) orders[orderIndex].deliveryMode = newDeliveryMode;
                    orders[orderIndex].updatedAt = new Date().toISOString();
                }
            });
            
            showNotification('Pedidos atualizados com sucesso!', 'success');
        } else {
            // 批量删除 - 直接删除，不需要确认文本
            orders = orders.filter(order => !selectedOrderIds.includes(order.id));
            showNotification(`${selectedOrderIds.length} pedidos excluídos com sucesso!`, 'success');
        }
        
        // Salvar alterações
        saveToLocalStorage();
        
        // 重新应用过滤器和更新显示
        applyFilters();
        
        // 关闭模态框
        closeBatchOperationsModal();
        
        // 清除选择
        selectedOrderIds = [];
        document.getElementById('selectAllOrders').checked = false;
        updateBatchOperationsButton();
    }
    
    // Funções de persistência de dados

    // Carregar dados do localStorage
    function loadFromLocalStorage() {
      try {
        const data = localStorage.getItem(STORAGE_KEY);
        if (data) {
          orders = JSON.parse(data);
          console.log('Dados carregados do armazenamento local com sucesso');
        } else {
          console.log('Nenhum dado encontrado no armazenamento local, usando dados padrão');
        }
      } catch (error) {
        console.error('Falha ao carregar dados do armazenamento local:', error);
      }
    }

    // Salvar no localStorage
    function saveToLocalStorage() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
        console.log('Dados salvos no armazenamento local');
        updateSyncStatus('Salvo localmente', 'success');
      } catch (error) {
        console.error('Falha ao salvar no armazenamento local:', error);
        updateSyncStatus('Falha ao salvar', 'error');
      }
    }

    // Sincronizar dados com o servidor
    async function syncWithServer() {
      updateSyncStatus('Sincronizando...', 'syncing');
      
      try {
        // Enviar dados locais para o servidor
        const response = await fetch(`${API_BASE_URL}/orders/sync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            orders: orders,
            lastSync: localStorage.getItem('lastSync')
          })
        });
        
        if (response.ok) {
          const result = await response.json();
          
          // Atualizar dados locais
          if (result.orders) {
            orders = result.orders;
            saveToLocalStorage();
            applyFilters();
            updateFilteredStatistics();
          }
          
          localStorage.setItem('lastSync', new Date().toISOString());
          updateSyncStatus('Sincronizado', 'success');
        } else {
          throw new Error('Resposta do servidor com erro');
        }
      } catch (error) {
        console.error('Falha na sincronização:', error);
        updateSyncStatus('Falha na sincronização', 'error');
        
        // Se for um erro de rede, mostrar modo offline
        if (error.name === 'TypeError') {
          updateSyncStatus('Modo offline', 'offline');
        }
      }
    }

    // Atualizar indicador de status de sincronização
    function updateSyncStatus(message, type) {
      const statusElement = document.getElementById('syncStatus');
      if (!statusElement) return;
      
      const dot = statusElement.querySelector('div');
      const text = statusElement.querySelector('span');
      
      text.textContent = message;
      
      // Remover classes anteriores
      dot.className = 'w-2 h-2 rounded-full mr-2';
      
      // Adicionar classe baseada no tipo
      switch(type) {
        case 'success':
          dot.classList.add('bg-green-500');
          break;
        case 'error':
          dot.classList.add('bg-red-500');
          break;
        case 'syncing':
          dot.classList.add('bg-blue-500', 'animate-pulse');
          break;
        case 'offline':
          dot.classList.add('bg-gray-500');
          break;
        default:
          dot.classList.add('bg-gray-300');
      }
    }

    // Adicionar elemento de status de sincronização ao cabeçalho
    function addSyncStatusElement() {
      const headerRight = document.querySelector('header .flex.items-center.justify-between');
      if (headerRight) {
        const syncContainer = document.createElement('div');
        syncContainer.className = 'flex items-center space-x-4';
        
        const syncStatusElement = document.createElement('div');
        syncStatusElement.id = 'syncStatus';
        syncStatusElement.className = 'flex items-center text-sm';
        syncStatusElement.innerHTML = `
          <div class="w-2 h-2 rounded-full mr-2 bg-gray-300"></div>
          <span>Não sincronizado</span>
        `;
        
        // Adicionar botão de sincronização manual
        const syncButton = document.createElement('button');
        syncButton.className = 'text-gray-500 hover:text-primary transition-colors';
        syncButton.innerHTML = '<i class="fa fa-refresh"></i>';
        syncButton.title = 'Sincronizar dados';
        syncButton.onclick = syncWithServer;
        
        syncContainer.appendChild(syncButton);
        syncContainer.appendChild(syncStatusElement);
        headerRight.appendChild(syncContainer);
      }
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        // Carregar dados do armazenamento local
        loadFromLocalStorage();
        
        // 初始化过滤器
        filterByStatus('all');
        
        // Adicionar elemento de status de sincronização
        addSyncStatusElement();
        
        // Configurar sincronização automática (a cada 5 minutos)
        setInterval(() => {
          if (navigator.onLine) {
            syncWithServer();
          }
        }, 5 * 60 * 1000);
        
        // Adicionar evento para sincronização quando voltar online
        window.addEventListener('online', () => {
          updateSyncStatus('Reconectado', 'success');
          syncWithServer();
        });
        
        window.addEventListener('offline', () => {
          updateSyncStatus('Offline', 'offline');
        });
        
        // 添加编辑表单提交事件监听
        document.getElementById('editOrderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const orderId = parseInt(document.getElementById('editOrderId').value);
            const orderIndex = orders.findIndex(o => o.id === orderId);
            
            if (orderIndex !== -1) {
                // 更新订单数据
                orders[orderIndex] = {
                    ...orders[orderIndex],
                    nf: document.getElementById('editNf').value,
                    company: document.getElementById('editCompany').value,
                    issueDate: document.getElementById('editIssueDate').value,
                    finalValue: parseFloat(document.getElementById('editFinalValue').value),
                    orderTypeDescription: document.getElementById('editOrderTypeDescription').value,
                    representative: document.getElementById('editRepresentative').value,
                    status: document.getElementById('editStatus').value,
                    cx: document.getElementById('editCx').value,
                    operator: document.getElementById('editOperator').value,
                    deliveryMode: document.getElementById('editDeliveryMode').value,
                    updatedAt: new Date().toISOString()
                };
                
                // Salvar alterações
                saveToLocalStorage();
                
                // 重新应用过滤器和更新显示
                applyFilters();
                
                // 关闭模态框
                closeEditOrderModal();
                
                // 显示成功消息
                showNotification('Pedido atualizado com sucesso!', 'success');
            }
        });
        
        // 添加批量操作表单提交事件监听
        document.getElementById('batchOperationsForm').addEventListener('submit', applyBatchOperations);
    });
  // Evitar perda de dados ao atualizar a página
  window.addEventListener('beforeunload', function(e) {
    // Se houver alterações não sincronizadas, alertar o usuário
    if (orders.length > 0 && document.getElementById('syncStatus') && 
        document.getElementById('syncStatus').querySelector('span').textContent !== 'Sincronizado') {
      e.preventDefault();
      e.returnValue = '';
    }
  });
  </script>

  <!-- 添加订单模态框 -->
  <div id="addOrderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800">Novo Pedido</h2>
            <button onclick="closeAddOrderModal()" class="text-gray-500 hover:text-gray-700">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          
          <form id="orderForm" class="space-y-4">
            <div>
              <label for="nf" class="block text-sm font-medium text-gray-700 mb-1">NF</label>
              <input type="text" id="nf" name="nf" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="company" class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <input type="text" id="company" name="company" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="issueDate" class="block text-sm font-medium text-gray-700 mb-1">Data de Emissão</label>
              <input type="date" id="issueDate" name="issueDate" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="finalValue" class="block text-sm font-medium text-gray-700 mb-1">Valor Final</label>
              <input type="number" id="finalValue" name="finalValue" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="orderTypeDescription" class="block text-sm font-medium text-gray-700 mb-1">Descrição do Tipo</label>
              <input type="text" id="orderTypeDescription" name="orderTypeDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="representative" class="block text-sm font-medium text-gray-700 mb-1">Representante</label>
              <input type="text" id="representative" name="representative" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
              <select id="status" name="status" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="Pendente">Pendente</option>
                <option value="Em Processamento">Em Processamento</option>
                <option value="Enviado">Enviado</option>
                <option value="Entregue">Entregue</option>
                <option value="Cancelado">Cancelado</option>
              </select>
            </div>
            
            <div>
              <label for="cx" class="block text-sm font-medium text-gray-700 mb-1">CX</label>
              <input type="text" id="cx" name="cx" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="operator" class="block text-sm font-medium text-gray-700 mb-1">Operador</label>
              <input type="text" id="operator" name="operator" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="deliveryMode" class="block text-sm font-medium text-gray-700 mb-1">Modo de Entrega</label>
              <input type="text" id="deliveryMode" name="deliveryMode" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
              <button type="button" onclick="closeAddOrderModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                Cancelar
              </button>
              <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                Adicionar Pedido
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- 编辑订单模态框 -->
  <div id="editOrderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800">Editar Pedido</h2>
            <button onclick="closeEditOrderModal()" class="text-gray-500 hover:text-gray-700">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          
          <form id="editOrderForm" class="space-y-4">
            <input type="hidden" id="editOrderId">
            
            <div>
              <label for="editNf" class="block text-sm font-medium text-gray-700 mb-1">NF</label>
              <input type="text" id="editNf" name="editNf" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editCompany" class="block text-sm font-medium text-gray-700 mb-1">Empresa</label>
              <input type="text" id="editCompany" name="editCompany" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editIssueDate" class="block text-sm font-medium text-gray-700 mb-1">Data de Emissão</label>
              <input type="date" id="editIssueDate" name="editIssueDate" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editFinalValue" class="block text-sm font-medium text-gray-700 mb-1">Valor Final</label>
              <input type="number" id="editFinalValue" name="editFinalValue" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editOrderTypeDescription" class="block text-sm font-medium text-gray-700 mb-1">Descrição do Tipo</label>
              <input type="text" id="editOrderTypeDescription" name="editOrderTypeDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editRepresentative" class="block text-sm font-medium text-gray-700 mb-1">Representante</label>
              <input type="text" id="editRepresentative" name="editRepresentative" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
              <select id="editStatus" name="editStatus" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="Pendente">Pendente</option>
                <option value="Em Processamento">Em Processamento</option>
                <option value="Enviado">Enviado</option>
                <option value="Entregue">Entregue</option>
                <option value="Cancelado">Cancelado</option>
              </select>
            </div>
            
            <div>
              <label for="editCx" class="block text-sm font-medium text-gray-700 mb-1">CX</label>
              <input type="text" id="editCx" name="editCx" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editOperator" class="block text-sm font-medium text-gray-700 mb-1">Operador</label>
              <input type="text" id="editOperator" name="editOperator" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label for="editDeliveryMode" class="block text-sm font-medium text-gray-700 mb-1">Modo de Entrega</label>
              <input type="text" id="editDeliveryMode" name="editDeliveryMode" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
              <button type="button" onclick="closeEditOrderModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                Cancelar
              </button>
              <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                Salvar Alterações
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 导入数据模态框 -->
  <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800">Importar Dados</h2>
            <button onclick="closeImportModal()" class="text-gray-500 hover:text-gray-700">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          
          <div class="space-y-4">
            <div id="dropArea" class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center hover:border-gray-400 transition-colors cursor-pointer">
              <p class="text-gray-500 mb-2">Arraste arquivos Excel aqui ou clique para selecionar</p>
              <input type="file" id="importFile" accept=".json,.csv,.xlsx,.xls" class="hidden">
              <button type="button" id="selectFileBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                Selecionar arquivo
              </button>
              <div id="fileInfo" class="mt-3 hidden">
                <p class="text-sm text-gray-600">
                  Arquivo selecionado: <span id="fileName" class="font-medium"></span> <span id="fileSize" class="text-gray-500"></span>
                </p>
              </div>
            </div>
            
            <div class="text-sm text-gray-600">
              <p class="mb-2">Formatos suportados:</p>
              <ul class="list-disc list-inside space-y-1">
                <li>JSON: Array de objetos com as propriedades dos pedidos</li>
                <li>CSV: Primeira linha com cabeçalhos, dados separados por vírgula</li>
                <li>Excel: Primeira linha com cabeçalhos</li>
              </ul>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
              <button type="button" onclick="closeImportModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                Cancelar
              </button>
              <button type="button" id="importBtn" onclick="processImport()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                Importar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    
    // 处理表单提交
    document.getElementById('orderForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // 获取表单数据
        const formData = {
            id: orders.length > 0 ? Math.max(...orders.map(o => o.id)) + 1 : 1,
            nf: document.getElementById('nf').value,
            company: document.getElementById('company').value,
            issueDate: document.getElementById('issueDate').value,
            finalValue: parseFloat(document.getElementById('finalValue').value),
            orderTypeDescription: document.getElementById('orderTypeDescription').value,
            representative: document.getElementById('representative').value,
            status: document.getElementById('status').value,
            cx: document.getElementById('cx').value,
            operator: document.getElementById('operator').value,
            deliveryMode: document.getElementById('deliveryMode').value,
            createdAt: new Date().toISOString()
        };
        
        // 添加到订单数组
        orders.push(formData);
        
        // Salvar alterações
        saveToLocalStorage();
        
        // 重新应用过滤器和更新显示
        applyFilters();
        
        // 关闭模态框
        closeAddOrderModal();
        
        // 显示成功消息
        showNotification('Pedido adicionado com sucesso!', 'success');
    });
    
    // 处理文件导入
    function processImport() {
        const fileInput = document.getElementById('importFile');
        const file = fileInput.files[0];
        
        if (!file) {
            alert('Selecionar arquivo！');
            return;
        }
        
        const fileName = file.name.toLowerCase();
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                let importedData = [];
                
                if (fileName.endsWith('.json')) {
                    // 处理JSON文件
                    importedData = JSON.parse(e.target.result);
                } else if (fileName.endsWith('.csv')) {
                    // 处理CSV文件
                    const csvData = e.target.result;
                    const lines = csvData.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',').map(v => v.trim());
                            const obj = {};
                            headers.forEach((header, index) => {
                                obj[header] = values[index] || '';
                            });
                            importedData.push(obj);
                        }
                    }
                } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                    // 处理Excel文件
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // 设置转换选项，确保所有数据都作为字符串读取
                    const options = {
                        raw: false,  // 返回格式化的字符串
                        dateNF: 'dd/mm/yyyy'  // 设置日期格式
                    };
                    
                    importedData = XLSX.utils.sheet_to_json(worksheet, options);
                    
                    // 处理每行数据，确保Pedido字段正确提取
                    importedData = importedData.map(row => {
                        // 直接使用row.Pedido作为订单号
                        const pedido = row.Pedido || '';
                        
                        return {
                            ...row,
                            pedido: pedido
                        };
                    });
                }
                
                // 处理导入的数据
                if (importedData.length > 0) {
                    // 为导入的数据分配新的ID
                    const maxId = orders.length > 0 ? Math.max(...orders.map(o => o.id)) : 0;
                    importedData.forEach((item, index) => {
                        item.id = maxId + index + 1;
                        
                        // 处理日期格式
                        if (item['Data de Emissão'] || item.issueDate) {
                            const dateValue = item['Data de Emissão'] || item.issueDate;
                            if (dateValue instanceof Date) {
                                // Excel日期对象转换为YYYY-MM-DD格式
                                const year = dateValue.getFullYear();
                                const month = String(dateValue.getMonth() + 1).padStart(2, '0');
                                const day = String(dateValue.getDate()).padStart(2, '0');
                                item.issueDate = `${year}-${month}-${day}`;
                            } else if (typeof dateValue === 'string') {
                                // 处理字符串日期格式
                                item.issueDate = dateValue;
                            }
                        }
                        
                        // 确保数值字段是数字类型
                        if (item.finalValue || item['Valor Final']) {
                            item.finalValue = parseFloat(item.finalValue || item['Valor Final']) || 0;
                        }
                        
                        // 映射字段名称
                        // 处理订货号 (Pedido)
                        const rowValues = Object.values(item);
                        for (const value of rowValues) {
                            if (typeof value === 'string' && /^[0-9]{12}$/.test(value)) {
                                item.pedido = value;
                                break;
                            }
                        }
                        
                        if (item['NF']) item.nf = item['NF'];
                        if (item['Cliente']) item.company = item['Cliente'];
                        if (item['Desc Tipo Pedido']) item.orderTypeDescription = item['Desc Tipo Pedido'];
                        if (item['Representante']) item.representative = item['Representante'];
                        if (item['CX']) item.cx = item['CX'];
                        if (item['Operador']) item.operator = item['Operador'];
                        if (item['Modalidade de entrega']) item.deliveryMode = item['Modalidade de entrega'];
                        
                        // 设置默认状态
                        if (!item.status) {
                            item.status = 'Aguardando';
                        }
                        
                        // Adicionar data de importação
                        item.importedAt = new Date().toISOString();
                    });
                    
                    // 添加到订单数组
                    orders.push(...importedData);
                    
                    // Salvar alterações
                    saveToLocalStorage();
                    
                    // 重新应用过滤器和更新显示
                    applyFilters();
                    
                    // 关闭模态框
                    closeImportModal();
                    
                    showNotification(`${importedData.length} pedidos importados com sucesso!`, 'success');
                } else {
                    showNotification('Nenhum dado encontrado no arquivo.', 'error');
                }
            } catch (error) {
                console.error('Erro ao importar arquivo:', error);
                showNotification('Erro ao importar arquivo. Verifique o formato.', 'error');
            }
        };
        
        // 根据文件类型选择读取方式
        if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
            reader.readAsArrayBuffer(file);
        } else {
            reader.readAsText(file);
        }
    }
    
    // 打印订单列表函数
    function printOrderList() {
      // 创建一个新窗口用于打印
      const printWindow = window.open('', '_blank');
      
      // 获取当前过滤后的订单
      const ordersToPrint = filteredOrders.length > 0 ? filteredOrders : orders;
      
      // 创建打印页面的HTML内容
      let printContent = `
        <!DOCTYPE html>
        <html lang="pt-BR">
        <head>
          <meta charset="UTF-8">
          <title>Lista de Pedidos</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { text-align: center; color: #165DFF; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
            th, td { border: 1px solid #E5E6EB; padding: 8px; text-align: left; }
            th { background-color: #F5F7FA; font-weight: bold; color: #4E5969; }
            tr:nth-child(even) { background-color: #F9FAFB; }
            .print-info { text-align: right; font-size: 12px; color: #86909C; margin-bottom: 20px; }
            .status-aguardando { color: #FF7D00; }
            .status-processando { color: #165DFF; }
            .status-concluido { color: #00B42A; }
            .status-cancelado { color: #F53F3F; }
          </style>
        </head>
        <body>
          <h1>Lista de Pedidos</h1>
          <div class="print-info">Data de impressão: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}</div>
          <table>
            <thead>
              <tr>
                <th>NF</th>
                <th>Pedido</th>
                <th>Cliente</th>
                <th>Data de Emissão</th>
                <th>Valor Final</th>
                <th>Tipo Pedido</th>
                <th>Representante</th>
                <th>Status</th>
                <th>CX</th>
                <th>Operador</th>
                <th>Modalidade</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      // 添加订单数据行
      ordersToPrint.forEach(order => {
        // 根据状态确定CSS类
        let statusClass = '';
        const status = order.status.toLowerCase();
        if (status.includes('aguardando') || status.includes('pendente')) {
          statusClass = 'status-aguardando';
        } else if (status.includes('processando') || status.includes('em andamento')) {
          statusClass = 'status-processando';
        } else if (status.includes('concluído') || status.includes('finalizado')) {
          statusClass = 'status-concluido';
        } else if (status.includes('cancelado')) {
          statusClass = 'status-cancelado';
        }
        
        // 格式化金额
        const formattedValue = new Intl.NumberFormat('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        }).format(order.finalValue || 0);
        
        // 添加行数据
        printContent += `
          <tr>
            <td>${formatValue(order.nf)}</td>
            <td>${formatValue(order.pedido)}</td>
            <td>${formatValue(order.company)}</td>
            <td>${formatValue(order.issueDate)}</td>
            <td>${formattedValue}</td>
            <td>${formatValue(order.orderTypeDescription)}</td>
            <td>${formatValue(order.representative)}</td>
            <td class="${statusClass}">${formatValue(order.status)}</td>
            <td>${formatValue(order.cx)}</td>
            <td>${formatValue(order.operator)}</td>
            <td>${formatValue(order.deliveryMode)}</td>
          </tr>
        `;
      });
      
      // 完成HTML内容
      printContent += `
            </tbody>
          </table>
        </body>
        </html>
      `;
      
      // 写入打印窗口并打印
      printWindow.document.open();
      printWindow.document.write(printContent);
      printWindow.document.close();
      
      // 确保样式加载完成后打印
      printWindow.onload = function() {
        printWindow.print();
        // printWindow.close(); // 如果希望打印后自动关闭窗口，可以取消注释
      };
      
      // 在打印窗口中定义formatValue函数
      printWindow.formatValue = function(value) {
        return value !== undefined && value !== null ? value : '';
      };
    }
    
    // 辅助函数：格式化值（处理undefined或null）
    function formatValue(value) {
      return value !== undefined && value !== null ? value : '';
    }
    
    // 切换状态下拉菜单显示/隐藏
    function toggleStatusDropdown(orderId, event) {
        event.stopPropagation(); // 阻止事件冒泡
        
        const dropdownId = `status-dropdown-${orderId}`;
        const dropdown = document.getElementById(dropdownId);
        
        // 如果有其他打开的下拉菜单，先关闭它
        if (currentOpenStatusDropdown && currentOpenStatusDropdown !== dropdownId) {
            document.getElementById(currentOpenStatusDropdown).classList.add('hidden');
        }
        
        // 切换当前下拉菜单的显示状态
        if (dropdown.classList.contains('hidden')) {
            dropdown.classList.remove('hidden');
            currentOpenStatusDropdown = dropdownId;
            
            // 定位下拉菜单
            const rect = event.target.getBoundingClientRect();
            dropdown.style.top = `${rect.bottom + window.scrollY}px`;
            dropdown.style.left = `${rect.left + window.scrollX}px`;
        } else {
            dropdown.classList.add('hidden');
            currentOpenStatusDropdown = null;
        }
    }
    
    // 更新订单状态
    function updateOrderStatus(orderId, newStatus) {
        // 查找订单
        const orderIndex = orders.findIndex(order => order.id === orderId);
        if (orderIndex === -1) return;
        
        // 更新状态
        orders[orderIndex].status = newStatus;
        
        // 关闭下拉菜单
        const dropdown = document.getElementById(`status-dropdown-${orderId}`);
        if (dropdown) {
            dropdown.classList.add('hidden');
            currentOpenStatusDropdown = null;
        }
        
        // 重新应用过滤器和更新显示
        applyFilters();
        
        // 显示成功消息
        showNotification(`Status do pedido #${orderId} atualizado para ${newStatus}`, 'success');
    }
    
    // 点击页面其他地方关闭下拉菜单
    document.addEventListener('click', function(event) {
        if (currentOpenStatusDropdown) {
            const dropdown = document.getElementById(currentOpenStatusDropdown);
            if (dropdown && !dropdown.contains(event.target)) {
                dropdown.classList.add('hidden');
                currentOpenStatusDropdown = null;
            }
        }
    });
    
    // 显示通知消息
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'} text-white`;
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fa ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-2"></i>
                <span>${message}</span>
            </div>
        `;
        document.body.appendChild(notification);
        
        // 3秒后自动消失
        setTimeout(() => {
            notification.classList.add('opacity-0', 'transition-opacity', 'duration-500');
            setTimeout(() => notification.remove(), 500);
        }, 3000);
    }
  // Evitar perda de dados ao atualizar a página
  window.addEventListener('beforeunload', function(e) {
    // Se houver alterações não sincronizadas, alertar o usuário
    if (orders.length > 0 && document.getElementById('syncStatus') && 
        document.getElementById('syncStatus').querySelector('span').textContent !== 'Sincronizado') {
      e.preventDefault();
      e.returnValue = '';
    }
  });
  </script>
  <!-- 批量操作模态框 -->
  <div id="batchOperationsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800">Operações em Lote</h2>
            <button onclick="closeBatchOperationsModal()" class="text-gray-500 hover:text-gray-700">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          
          <form id="batchOperationsForm" class="space-y-4">
            <div class="text-sm text-gray-500 mb-4">
              <span id="selectedOrdersCount">0</span> pedidos selecionados
            </div>
            
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Operação</label>
              <div class="space-y-2">
                <div>
                  <label class="inline-flex items-center">
                    <input type="radio" name="operationType" value="update" class="form-radio h-4 w-4 text-blue-600" checked>
                    <span class="ml-2">Atualizar campos</span>
                  </label>
                </div>
                <div>
                  <label class="inline-flex items-center">
                    <input type="radio" name="operationType" value="delete" class="form-radio h-4 w-4 text-red-600">
                    <span class="ml-2 text-red-600 font-medium">Excluir pedidos</span>
                  </label>
                </div>
              </div>
            </div>
            
            <div id="updateFieldsSection">
              <label class="block text-sm font-medium text-gray-700 mb-1">Campos para atualizar</label>
              <div class="space-y-2">
                <div>
                  <label class="inline-flex items-center">
                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="updateStatus">
                    <span class="ml-2">Status</span>
                  </label>
                  <select id="batchStatus" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                    <option value="Aguardando">Aguardando</option>
                    <option value="Processando">Processando</option>
                    <option value="Concluído">Concluído</option>
                    <option value="Cancelado">Cancelado</option>
                  </select>
                </div>
                
                <div>
                  <label class="inline-flex items-center">
                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="updateRepresentative">
                    <span class="ml-2">Representante</span>
                  </label>
                  <input type="text" id="batchRepresentative" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                </div>
                
                <div>
                  <label class="inline-flex items-center">
                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="updateOperator">
                    <span class="ml-2">Operador</span>
                  </label>
                  <input type="text" id="batchOperator" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                </div>
                
                <div>
                  <label class="inline-flex items-center">
                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="updateDeliveryMode">
                    <span class="ml-2">Modo de Entrega</span>
                  </label>
                  <input type="text" id="batchDeliveryMode" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" disabled>
                </div>
              </div>
            </div>
            
            <div id="deleteConfirmSection" class="hidden">
              <div class="bg-red-50 border border-red-200 rounded-md p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">Atenção: Esta ação não pode ser desfeita</h3>
                    <div class="mt-2 text-sm text-red-700">
                      <p>Você está prestes a excluir <span id="deleteOrdersCount" class="font-bold">0</span> pedidos.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
              <button type="button" onclick="closeBatchOperationsModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                Cancelar
              </button>
              <button type="submit" id="batchSubmitBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                Aplicar Alterações
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
